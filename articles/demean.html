<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Analysing Longitudinal or Panel Data • parameters</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../katex-auto.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/Roboto-0.4.9/font.css" rel="stylesheet">
<link href="../deps/JetBrains_Mono-0.4.9/font.css" rel="stylesheet">
<link href="../deps/Roboto_Slab-0.4.9/font.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><link href="../deps/KaTex-0.16.10/katex.min.css" rel="stylesheet">
<script src="../deps/KaTex-0.16.10/katex.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Analysing Longitudinal or Panel Data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">parameters</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.23.0.11</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html" aria-label="Reference"><span class="fa fa-file-code"></span> Reference</a></li>
<li class="active nav-item"><a class="nav-link" href="../articles/index.html" aria-label="Articles"><span class="fa fa-book-reader"></span> Articles</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html" aria-label="News"><span class="fa fa-newspaper"></span> News</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-easystats" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="easystats"><span class="fa fab fa-r-project"></span> easystats</button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-easystats">
<li><a class="external-link dropdown-item" href="https://easystats.github.io/bayestestR/">bayestestR</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/correlation/">correlation</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/datawizard/">datawizard</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/easystats/">easystats</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/effectsize/">effectsize</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/insight/">insight</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/modelbased/">modelbased</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/performance/">performance</a></li>
    <li><a class="dropdown-item" href="https://easystats.github.io/parameters/">parameters</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/report/">report</a></li>
    <li><a class="external-link dropdown-item" href="https://easystats.github.io/see/">see</a></li>
  </ul>
</li>
<li class="nav-item"><a class="external-link nav-link" href="http://twitter.com/easystats4u" aria-label="Twitter"><span class="fa fa-twitter"></span></a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/easystats/parameters/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Analysing Longitudinal or Panel Data</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/easystats/parameters/blob/main/vignettes/demean.Rmd" class="external-link"><code>vignettes/demean.Rmd</code></a></small>
      <div class="d-none name"><code>demean.Rmd</code></div>
    </div>

    
    
<p>This vignette explains the rational behind the <code><a href="https://easystats.github.io/datawizard/reference/demean.html" class="external-link">demean()</a></code>
function.</p>
<p>We give recommendations how to analyze multilevel or hierarchical
data structures, when macro-indicators (or level-2 predictors, or
higher-level units, or more general: <em>group-level predictors</em>)
are used as covariates and the model suffers from <strong>heterogeneity
bias</strong> <span class="citation">(Bell and Jones 2015)</span>.</p>
<div class="section level2">
<h2 id="sample-data-used-in-this-vignette">Sample data used in this vignette<a class="anchor" aria-label="anchor" href="#sample-data-used-in-this-vignette"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/parameters/">parameters</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"qol_cancer"</span><span class="op">)</span></span></code></pre></div>
<ul>
<li>
<p>Variables:</p>
<ul>
<li><p><code>QoL</code> : Response (quality of life of patient)</p></li>
<li><p><code>phq4</code> : Patient Health Questionnaire,
<strong>time-varying</strong> variable</p></li>
<li><p><code>hospital</code> : Location of treatment,
<strong>time-invariant</strong> variable, co-variate</p></li>
<li><p><code>education</code>: Educational level,
<strong>time-invariant</strong> variable, co-variate</p></li>
<li><p><code>ID</code> : patient ID</p></li>
<li><p><code>time</code> : time-point of measurement</p></li>
</ul>
</li>
</ul>
</div>
<div class="section level2">
<h2 id="heterogeneity-bias">Heterogeneity bias<a class="anchor" aria-label="anchor" href="#heterogeneity-bias"></a>
</h2>
<p>Heterogeneity bias occurs when group-level predictors vary within and
across groups, and hence fixed effects may correlate with group (or
random) effects. This is a typical situation when analyzing longitudinal
or panel data: Due to the repeated measurements of persons, the “person”
(or subject-ID) is now a level-2 variable. Predictors at level-1 (“fixed
effects”), e.g. self-rated health or income, now have an effect at
level-1 (“within”-effect) and at higher-level units (level-2, the
subject-level, which is the “between”-effect) (see also <a href="https://shouldbewriting.netlify.app/posts/2019-10-21-accounting-for-within-and-between-subject-effect/" class="external-link">this
posting</a>). This inevitably leads to correlating fixed effects and
error terms - which, in turn, results in biased estimates, because both
the within- <em>and</em> between-effect are captured in <em>one</em>
estimate.</p>
<p>You can check if your model may suffer from heterogeneity bias using
the <code><a href="https://easystats.github.io/performance/reference/check_heterogeneity_bias.html" class="external-link">check_heterogeneity_bias()</a></code> function:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/performance/" class="external-link">performance</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://easystats.github.io/performance/reference/check_heterogeneity_bias.html" class="external-link">check_heterogeneity_bias</a></span><span class="op">(</span><span class="va">qol_cancer</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"phq4"</span>, <span class="st">"education"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Possible heterogeneity bias due to following predictors: phq4</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="adressing-heterogeneity-bias-the-fixed-effects-regression-fe-approach">Adressing heterogeneity bias: the Fixed Effects Regression (FE)
approach<a class="anchor" aria-label="anchor" href="#adressing-heterogeneity-bias-the-fixed-effects-regression-fe-approach"></a>
</h2>
<p>Fixed effects regression models (FE) are a popular approach for panel
data analysis in particular in econometrics and considered as gold
standard. To avoid the problem of heterogeneity bias, in FE all
higher-level variance (and thus, any between-effects), “are controlled
out using the higher-level entities themselves, included in the model as
dummy variables” <span class="citation">(Bell and Jones 2015)</span>. As
a consequence, FE models are only able estimate
<em>within-effects</em>.</p>
<p>To remove between-effects and only model within-effects, the data
needs some preparation: <em>de-meaning</em>. De-meaning, or
<em>person-mean centering</em>, or <em>centering within clusters</em>,
takes away the higher-level mean from the regression equation, and as
such, FE avoids estimating a parameter for each higher-level unit.</p>
<div class="section level3">
<h3 id="computing-the-de-meaned-and-group-meaned-variables">Computing the de-meaned and group-meaned variables<a class="anchor" aria-label="anchor" href="#computing-the-de-meaned-and-group-meaned-variables"></a>
</h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">qol_cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>  <span class="va">qol_cancer</span>,</span>
<span>  <span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/demean.html" class="external-link">demean</a></span><span class="op">(</span><span class="va">qol_cancer</span>, select <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"phq4"</span>, <span class="st">"QoL"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we have:</p>
<ul>
<li><p><code>phq4_between</code>: time-varying variable with the mean of
<code>phq4</code> across all time-points, for each patient
(ID).</p></li>
<li><p><code>phq4_within</code>: the de-meaned time-varying variable
<code>phq4</code>.</p></li>
</ul>
<p>A FE model is a classical linear model, where</p>
<ul>
<li><p>Intercept is removed</p></li>
<li><p>time-invariant predictors are not allowed to be included</p></li>
<li><p>the group-level factor is included as predictor</p></li>
<li><p>time-varying predictors are de-meaned (“person-mean centered”,
indicating the “within-subject” effect)</p></li>
</ul>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fe_model1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">QoL</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">time</span> <span class="op">+</span> <span class="va">phq4_within</span> <span class="op">+</span> <span class="va">ID</span>,</span>
<span>  data <span class="op">=</span> <span class="va">qol_cancer</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># we use only the first two rows, because the remaining rows are</span></span>
<span><span class="co"># the estimates for "ID", which is not of interest here...</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">fe_model1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(374) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; time        |        1.09 | 0.64 | [-0.17,  2.34] |   1.70 | 0.089 </span></span>
<span><span class="co">#&gt; phq4 within |       -3.66 | 0.41 | [-4.46, -2.86] |  -8.95 | &lt; .001</span></span>
<span></span>
<span></span>
<span><span class="co"># instead of removing the intercept, we could also use the</span></span>
<span><span class="co"># de-meaned response...</span></span>
<span><span class="va">fe_model2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span></span>
<span>  <span class="va">QoL_within</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="va">phq4_within</span> <span class="op">+</span> <span class="va">ID</span>,</span>
<span>  data <span class="op">=</span> <span class="va">qol_cancer</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">fe_model2</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(374) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; time        |        1.09 | 0.64 | [-0.17,  2.34] |   1.70 | 0.089 </span></span>
<span><span class="co">#&gt; phq4 within |       -3.66 | 0.41 | [-4.46, -2.86] |  -8.95 | &lt; .001</span></span>
<span></span>
<span><span class="co"># we compare the results with those from the "lfe"-package for panel data</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/r-econometrics/lfe" class="external-link">lfe</a></span><span class="op">)</span></span>
<span><span class="va">fe_model3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lfe/man/felm.html" class="external-link">felm</a></span><span class="op">(</span></span>
<span>  <span class="va">QoL</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="va">phq4</span> <span class="op">|</span> <span class="va">ID</span>,</span>
<span>  data <span class="op">=</span> <span class="va">qol_cancer</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">fe_model3</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Fixed Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter | Coefficient |   SE |         95% CI | t(374) |      p</span></span>
<span><span class="co">#&gt; -----------------------------------------------------------------</span></span>
<span><span class="co">#&gt; time      |        1.09 | 0.64 | [-0.17,  2.34] |   1.70 | 0.089 </span></span>
<span><span class="co">#&gt; phq4      |       -3.66 | 0.41 | [-4.46, -2.86] |  -8.95 | &lt; .001</span></span></code></pre></div>
<p>As we can see, the <em>within-effect</em> of PHQ-4 is
<code>-3.66</code>, hence the mean of the change for an average
individual case in our sample (or, the “net” effect), is
<code>-3.66</code>.</p>
<p>But what about the between-effect? How do people with higher PHQ-4
score differ from people with lower PHQ-4 score? Or what about
educational inequalities? Do higher educated people have a higher PHQ-4
score than lower educated people?</p>
<p>This question cannot be answered with FE regression. But: “Can one
fit a multilevel model with varying intercepts (or coefficients) when
the units and predictors correlate? The answer is yes. And the solution
is simple.” <span class="citation">(Bafumi and Gelman 2006)</span></p>
</div>
</div>
<div class="section level2">
<h2 id="adressing-heterogeneity-bias-the-mixed-model-approach">Adressing heterogeneity bias: the Mixed Model approach<a class="anchor" aria-label="anchor" href="#adressing-heterogeneity-bias-the-mixed-model-approach"></a>
</h2>
<p>Mixed models include different levels of sources of variability
(i.e. error terms at each level). Predictors used at level-1 that are
varying across higher-level units will thus have residual errors at both
level-1 and higher-level units. “Such covariates contain two parts: one
that is specific to the higher-level entity that does not vary between
occasions, and one that represents the difference between occasions,
within higher-level entities” <span class="citation">(Bell and Jones
2015)</span>. Hence, the error terms will be correlated with the
covariate, which violates one of the assumptions of mixed models (iid,
independent and identically distributed error terms) - also known and
described above as <em>heterogeneity bias</em>.</p>
<p>But how can this issue be addressed outside the FE framework?</p>
<p>There are several ways how to address this using a mixed models
approach:</p>
<ul>
<li><p>Correlated group factors and predictors are no problem anyway,
because <a href="https://www.tjmahr.com/plotting-partial-pooling-in-mixed-effects-models/" class="external-link">partial
pooling</a> allows estimates of units o borrow strength from the whole
sample and shrink toward a common mean (<span class="citation">Shor et
al. (2007)</span>).</p></li>
<li><p>If predictor and group factors correlate, one can remove this
correlation by group-meaning <span class="citation">(or “mean within
clusters,” Bafumi and Gelman 2006; Gelman and Hill 2007, chap.
12.6.)</span>.</p></li>
<li><p>When time-varying predictors are “decomposed” into their
time-varying and time-invariant components (de-meaning), then mixed
models can model <strong>both</strong> within- and between-subject
effects <span class="citation">(Bell, Fairbrother, and Jones
2019)</span> - this approach is essentially a further development of a
long-known recommendation by Mundlak <span class="citation">(Mundlak
1978)</span>.</p></li>
</ul>
<p>For now, we will follow the last recommendation and use the within-
and between-version of <code>phq4</code>.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/lme4/lme4/" class="external-link">lme4</a></span><span class="op">)</span></span>
<span><span class="va">mixed_1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span></span>
<span>  <span class="va">QoL</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="va">phq4_within</span> <span class="op">+</span> <span class="va">phq4_between</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">qol_cancer</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">mixed_1</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Fixed Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter    | Coefficient |   SE |         95% CI | t(558) |      p</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept)  |       71.53 | 1.56 | [68.48, 74.59] |  45.98 | &lt; .001</span></span>
<span><span class="co">#&gt; time         |        1.09 | 0.64 | [-0.17,  2.34] |   1.70 | 0.089 </span></span>
<span><span class="co">#&gt; phq4 within  |       -3.66 | 0.41 | [-4.46, -2.86] |  -8.95 | &lt; .001</span></span>
<span><span class="co">#&gt; phq4 between |       -6.28 | 0.50 | [-7.27, -5.30] | -12.53 | &lt; .001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Random Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter          | Coefficient |   SE |         95% CI</span></span>
<span><span class="co">#&gt; --------------------------------------------------------</span></span>
<span><span class="co">#&gt; SD (Intercept: ID) |        9.88 | 0.80 | [ 8.43, 11.58]</span></span>
<span><span class="co">#&gt; SD (Residual)      |       12.37 | 0.45 | [11.51, 13.28]</span></span>
<span></span>
<span><span class="co"># compare to FE-model</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">fe_model1</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(374) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; time        |        1.09 | 0.64 | [-0.17,  2.34] |   1.70 | 0.089 </span></span>
<span><span class="co">#&gt; phq4 within |       -3.66 | 0.41 | [-4.46, -2.86] |  -8.95 | &lt; .001</span></span></code></pre></div>
<p>As we can see, the estimates and standard errors are identical. The
argument <em>against</em> the use of mixed models, i.e. that using mixed
models for panel data will yield biased estimates and standard errors,
is based on an incorrect model specification <span class="citation">(Mundlak 1978)</span>. As such, when the (mixed) model
is properly specified, the estimator of the mixed model is identical to
the ‘within’ (i.e. FE) estimator.</p>
<p>As a consequence, we cannot only use the above specified mixed model
for panel data, we can even specify more complex models including
within-effects, between-effects or random effects variation. A mixed
models approach can model the causes of endogeneity explicitly by
including the (separated) within- and between-effects of time-varying
fixed effects and including time-constant fixed effects.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mixed_2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span></span>
<span>  <span class="va">QoL</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="va">phq4_within</span> <span class="op">+</span> <span class="va">phq4_between</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">time</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">qol_cancer</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># effects = "fixed" will not display random effects, but split the</span></span>
<span><span class="co"># fixed effects into its between- and within-effects components.</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">mixed_2</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter        | Coefficient |   SE |         95% CI | t(554) |      p</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept)      |       67.36 | 2.48 | [62.48, 72.23] |  27.15 | &lt; .001</span></span>
<span><span class="co">#&gt; time             |        1.09 | 0.66 | [-0.21,  2.39] |   1.65 | 0.099 </span></span>
<span><span class="co">#&gt; education [mid]  |        5.01 | 2.35 | [ 0.40,  9.62] |   2.14 | 0.033 </span></span>
<span><span class="co">#&gt; education [high] |        5.52 | 2.75 | [ 0.11, 10.93] |   2.00 | 0.046 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Within-Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(554) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; phq4 within |       -3.72 | 0.41 | [-4.52, -2.92] |  -9.10 | &lt; .001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Between-Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter    | Coefficient |   SE |         95% CI | t(554) |      p</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; phq4 between |       -6.13 | 0.52 | [-7.14, -5.11] | -11.84 | &lt; .001</span></span></code></pre></div>
<p>For more complex models, within-effects will naturally change
slightly and are no longer identical to simpler FE models. This is no
“bias”, but rather the result of building more complex models: FE models
lack information of variation in the group-effects or between-subject
effects. Furthermore, FE models cannot include random slopes, which
means that fixed effects regressions are neglecting “cross-cluster
differences in the effects of lower-level controls (which) reduces the
precision of estimated context effects, resulting in (…) low statistical
power” <span class="citation">(Heisig, Schaeffer, and Giesecke
2017)</span>.</p>
</div>
<div class="section level2">
<h2 id="conclusion-complex-random-effects-within-between-models">Conclusion: Complex Random Effects Within-Between Models<a class="anchor" aria-label="anchor" href="#conclusion-complex-random-effects-within-between-models"></a>
</h2>
<p>Depending on the structure of the data, the best approach to
analyzing panel data would be a so called “complex random effects
within-between” model <span class="citation">(Bell, Fairbrother, and
Jones 2019)</span>:</p>
<p>y<sub>it</sub> = β<sub>0</sub> + β<sub>1W</sub> (x<sub>it</sub> -
͞x<sub>i</sub>) + β<sub>2B</sub> ͞x<sub>i</sub> + β<sub>3</sub>
z<sub>i</sub> + υ<sub>i0</sub> + υ<sub>i1</sub> (x<sub>it</sub> -
͞x<sub>i</sub>) + ε<sub>it</sub></p>
<ul>
<li>
x<sub>it</sub> - ͞x<sub>i</sub> is the de-meaned predictor,
<em>phq4_within</em>
</li>
<li>
͞x<sub>i</sub> is the group-meaned predictor, <em>phq4_between</em>
</li>
<li>
β<sub>1W</sub> is the coefficient for phq4_within (within-subject)
</li>
<li>
β<sub>2B</sub> is the coefficient for phq4_between (bewteen-subject)
</li>
<li>
β<sub>3</sub> is the coefficient for time-constant predictors, such as
<code>hospital</code> or <code>education</code> (bewteen-subject)
</li>
</ul>
<p>In R-code, the model is written down like this:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># We ignore the convergence warnings for now...</span></span>
<span><span class="va">rewb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/warning.html" class="external-link">suppressWarnings</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span></span>
<span>  <span class="va">QoL</span> <span class="op">~</span> <span class="va">time</span> <span class="op">+</span> <span class="va">phq4_within</span> <span class="op">+</span> <span class="va">phq4_between</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span></span>
<span>    <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">time</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">phq4_within</span> <span class="op">|</span> <span class="va">ID</span><span class="op">)</span>,</span>
<span>  data <span class="op">=</span> <span class="va">qol_cancer</span></span>
<span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><strong>What about time-constant predictors?</strong></p>
<p>After de-meaning time-varying predictors, “at the higher level, the
mean term is no longer constrained by Level 1 effects, so it is free to
account for all the higher-level variance associated with that variable”
<span class="citation">(Bell and Jones 2015)</span>.</p>
<p>Thus, <em>time-constant <strong>categorical</strong></em> predictors,
that only have a between-effect, can be simply included as fixed effects
predictor (since they’re not constrained by level-1 effects).
Time-constant <em>continuous</em> <strong>group-level
predictors</strong> (for instance, GDP of countries) should be
group-meaned, to have a proper “between”-effect <span class="citation">(Gelman and Hill 2007, chap. 12.6.)</span>.</p>
<p>The benefit of this kind of model is that you have information on
within-, between- and other time-constant (i.e. between) effects or
group-level predictors…</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">rewb</span>, effects <span class="op">=</span> <span class="st">"fixed"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter        | Coefficient |   SE |         95% CI | t(551) |      p</span></span>
<span><span class="co">#&gt; ------------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept)      |       67.18 | 2.39 | [62.49, 71.87] |  28.13 | &lt; .001</span></span>
<span><span class="co">#&gt; time             |        1.18 | 0.60 | [-0.01,  2.37] |   1.95 | 0.051 </span></span>
<span><span class="co">#&gt; education [mid]  |        4.95 | 2.35 | [ 0.34,  9.56] |   2.11 | 0.035 </span></span>
<span><span class="co">#&gt; education [high] |        5.62 | 2.76 | [ 0.20, 11.04] |   2.04 | 0.042 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Within-Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(551) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; phq4 within |       -4.50 | 0.58 | [-5.64, -3.36] |  -7.78 | &lt; .001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Between-Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter    | Coefficient |   SE |         95% CI | t(551) |      p</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; phq4 between |       -6.11 | 0.52 | [-7.13, -5.10] | -11.81 | &lt; .001</span></span></code></pre></div>
<p>… but you can also model the variation of (group) effects across time
(and probably space), and you can even include more higher-level units
(e.g. nested design or cross-classified design with more than two
levels):</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/random_parameters.html">random_parameters</a></span><span class="op">(</span><span class="va">rewb</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Random Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Within-Group Variance              119.51 (10.93)</span></span>
<span><span class="co">#&gt; Between-Group Variance</span></span>
<span><span class="co">#&gt;   Random Intercept (ID)            111.26 (10.55)</span></span>
<span><span class="co">#&gt;   Random Intercept (ID.1)           21.86  (4.68)</span></span>
<span><span class="co">#&gt;   Random Slope (ID.time)             0.46  (0.68)</span></span>
<span><span class="co">#&gt;   Random Slope (ID.1.phq4_within)   14.37  (3.79)</span></span>
<span><span class="co">#&gt; Correlations</span></span>
<span><span class="co">#&gt;   ID.time                              -1</span></span>
<span><span class="co">#&gt;   ID.phq4_within                     0.48</span></span>
<span><span class="co">#&gt; N (groups per factor)</span></span>
<span><span class="co">#&gt;   ID                                  188</span></span>
<span><span class="co">#&gt; Observations                          564</span></span></code></pre></div>
<p><strong>What about imbalanced groups, i.e. large differences in N per
group?</strong></p>
<p>See little example after this visual example…</p>
</div>
<div class="section level2">
<h2 id="a-visual-example">A visual example<a class="anchor" aria-label="anchor" href="#a-visual-example"></a>
</h2>
<p>First, we generate some fake data that implies a linear relationship
between outcome and independent variable. The objective is that the
amount of typing errors depends on how fast (typing speed) you can type,
however, the more typing experience you have, the faster you can type.
Thus, the outcome measure is “amount of typing errors”, while our
predictor is “typing speed”. Furthermore, we have repeated measurements
of people with different “typing experience levels”.</p>
<p>The results show that we will have two sources of variation: Overall,
more experienced typists make less mistakes (group-level pattern). When
typing faster, typists make more mistakes (individual-level
pattern).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://nathaneastwood.github.io/poorman/" class="external-link">poorman</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://easystats.github.io/see/" class="external-link">see</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">n</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">b</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span>,</span>
<span>    grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://nathaneastwood.github.io/poorman/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nathaneastwood.github.io/poorman/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span> <span class="op"><a href="https://nathaneastwood.github.io/poorman/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nathaneastwood.github.io/poorman/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fl">15</span> <span class="op">-</span> <span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://nathaneastwood.github.io/poorman/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nathaneastwood.github.io/poorman/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"very slow"</span>, <span class="st">"slow"</span>, <span class="st">"average"</span>, <span class="st">"fast"</span>, <span class="st">"very fast"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">grp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">labs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/demean.html" class="external-link">demean</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"grp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Let’s look at the raw data…</p>
<p><img src="demean_files/figure-html/unnamed-chunk-14-1.png" width="100%"></p>
<div class="section level3">
<h3 id="model-1-linear-relationship-between-typing-errors-and-typing-speed">Model 1: Linear relationship between typing errors and typing
speed<a class="anchor" aria-label="anchor" href="#model-1-linear-relationship-between-typing-errors-and-typing-speed"></a>
</h3>
<p>We can now assume a (linear) relationship between typing errors and
typing speed.</p>
<p><img src="demean_files/figure-html/unnamed-chunk-15-1.png" width="100%"></p>
<p>Looking at the coefficients, we have following model with a
coefficient of <code>-1.92</code>.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(103) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       30.20 | 1.42 | [27.39, 33.00] |  21.34 | &lt; .001</span></span>
<span><span class="co">#&gt; x           |       -1.92 | 0.18 | [-2.27, -1.56] | -10.69 | &lt; .001</span></span></code></pre></div>
<p>However, we have ignored the clustered structure in our data, in this
example due to repeated measurements.</p>
<p><img src="demean_files/figure-html/unnamed-chunk-17-1.png" width="100%"></p>
</div>
<div class="section level3">
<h3 id="model-2-within-subject-effect-of-typing-speed">Model 2: Within-subject effect of typing speed<a class="anchor" aria-label="anchor" href="#model-2-within-subject-effect-of-typing-speed"></a>
</h3>
<p>A fixed effects regression (FE-regression) would now remove all
between-effects and include only the within-effects as well as the
group-level indicator.</p>
<p><img src="demean_files/figure-html/unnamed-chunk-18-1.png" width="100%"></p>
<p>This returns the coefficient of the “within”-effect, which is
<code>1.2</code>, with a standard error of <code>0.07</code>. Note that
the FE-model does <em>not</em> take the variation <em>between</em>
subjects into account, thus resulting in (possibly) biased estimates,
and biased standard errors.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="fl">0</span> <span class="op">+</span> <span class="va">x_within</span> <span class="op">+</span> <span class="va">grp</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span>, <span class="op">]</span></span>
<span><span class="co">#&gt; Parameter | Coefficient |   SE |       95% CI | t(99) |      p</span></span>
<span><span class="co">#&gt; --------------------------------------------------------------</span></span>
<span><span class="co">#&gt; x within  |        1.20 | 0.07 | [1.06, 1.35] | 16.08 | &lt; .001</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-3-between-subject-effect-of-typing-speed">Model 3: Between-subject effect of typing speed<a class="anchor" aria-label="anchor" href="#model-3-between-subject-effect-of-typing-speed"></a>
</h3>
<p>To understand, why the above model 1 (<code>m1</code>) returns a
biased estimate, which is a “weighted average” of the within- and
between-effects, let us look at the between-effect now.</p>
<p><img src="demean_files/figure-html/unnamed-chunk-20-1.png" width="100%"></p>
<p>As we can see, the between-effect is <code>-2.93</code>, which is
different from the <code>-1.92</code> estimated in the model
<code>m1</code>.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_between</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">m3</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(103) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       37.83 | 0.62 | [36.59, 39.06] |  60.79 | &lt; .001</span></span>
<span><span class="co">#&gt; x between   |       -2.93 | 0.08 | [-3.09, -2.78] | -36.76 | &lt; .001</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-4-mixed-model-with-within--and-between-subjects">Model 4: Mixed model with within- and between-subjects<a class="anchor" aria-label="anchor" href="#model-4-mixed-model-with-within--and-between-subjects"></a>
</h3>
<p>Since FE-models can only model within-effects, we now use a mixed
model with within- and between-effects.</p>
<p><img src="demean_files/figure-html/unnamed-chunk-22-1.png" width="100%"></p>
<p>We see, the estimate for the within-effects is <em>not</em> biased.
Furthermore, we get the correct between-effect as well (standard errors
differ, because the variance in the grouping structure is more
accurately taken into account).</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m4</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_between</span> <span class="op">+</span> <span class="va">x_within</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">grp</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">m4</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Fixed Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(100) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       37.83 | 0.33 | [37.17, 38.48] | 114.46 | &lt; .001</span></span>
<span><span class="co">#&gt; x between   |       -2.93 | 0.04 | [-3.02, -2.85] | -69.22 | &lt; .001</span></span>
<span><span class="co">#&gt; x within    |        1.20 | 0.07 | [ 1.06,  1.35] |  16.22 | &lt; .001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Random Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter           | Coefficient</span></span>
<span><span class="co">#&gt; ---------------------------------</span></span>
<span><span class="co">#&gt; SD (Intercept: grp) |        0.00</span></span>
<span><span class="co">#&gt; SD (Residual)       |        0.92</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="model-5-complex-random-effects-within-between-model">Model 5: Complex Random-Effects Within-Between Model<a class="anchor" aria-label="anchor" href="#model-5-complex-random-effects-within-between-model"></a>
</h3>
<p>Finally, we can also take the variation between subjects into account
by adding a random slope. This model can be called a complex “REWB”
(random-effects within-between) model. Due to the variation between
subjects, we get larger standard errors for the within-effect.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">m5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_between</span> <span class="op">+</span> <span class="va">x_within</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">x_within</span> <span class="op">|</span> <span class="va">grp</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">m5</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Fixed Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI |  t(98) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       37.95 | 0.34 | [37.28, 38.63] | 111.15 | &lt; .001</span></span>
<span><span class="co">#&gt; x between   |       -2.95 | 0.04 | [-3.04, -2.87] | -67.57 | &lt; .001</span></span>
<span><span class="co">#&gt; x within    |        1.20 | 0.10 | [ 1.01,  1.40] |  12.16 | &lt; .001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Random Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter                     | Coefficient |   SE |         95% CI</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; SD (Intercept: grp)           |        0.09 | 0.22 | [ 0.00, 14.20]</span></span>
<span><span class="co">#&gt; SD (x_within: grp)            |        0.15 | 0.12 | [ 0.03,  0.69]</span></span>
<span><span class="co">#&gt; Cor (Intercept~x_within: grp) |       -1.00 | 2.18 | [-1.00,      ]</span></span>
<span><span class="co">#&gt; SD (Residual)                 |        0.90 | 0.07 | [ 0.78,  1.04]</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="balanced-versus-imbalanced-groups">Balanced versus imbalanced groups<a class="anchor" aria-label="anchor" href="#balanced-versus-imbalanced-groups"></a>
</h2>
<p>The “simple” linear slope of the between-effect (and also from the
within-effect) is (almost) identical in “classical” linear regression
compared to linear mixed models when the groups are balanced, i.e. when
the number of observation per group is similar or the same.</p>
<p>Whenever group size is imbalanced, the “simple” linear slope will be
adjusted. This leads to different estimates for between-effects between
classical and mixed models regressions due to shrinkage - i.e. for
larger variation of group sizes we find stronger regularization of
estimates.</p>
<p>Hence, for mixed models with larger differences in number of
observation per random effects group, the between-effect will differ
from the between-effect calculated by “classical” regression models.
However, this shrinkage is a desired property of mixed models and
usually improves the estimates.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">n</span> <span class="op">&lt;-</span> <span class="fl">5</span></span>
<span><span class="va">b</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.5</span>, length.out <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">n</span>, <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">n</span>, <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span>,</span>
<span>    y <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">x</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">+</span> <span class="va">b</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">n</span>, by <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fl">21</span><span class="op">)</span>,</span>
<span>    grp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">i</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create imbalanced groups</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">grp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">grp</span> <span class="op">==</span> <span class="fl">8</span><span class="op">)</span>, <span class="fl">10</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">grp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">grp</span> <span class="op">==</span> <span class="fl">4</span><span class="op">)</span>, <span class="fl">8</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">2</span></span>
<span><span class="va">d</span><span class="op">$</span><span class="va">grp</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">grp</span> <span class="op">==</span> <span class="fl">10</span><span class="op">)</span>, <span class="fl">9</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">6</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="va">d</span> <span class="op"><a href="https://nathaneastwood.github.io/poorman/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nathaneastwood.github.io/poorman/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span> <span class="op"><a href="https://nathaneastwood.github.io/poorman/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nathaneastwood.github.io/poorman/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="fl">15</span> <span class="op">-</span> <span class="op">(</span><span class="va">x</span> <span class="op">+</span> <span class="fl">1.5</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">grp</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://nathaneastwood.github.io/poorman/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://nathaneastwood.github.io/poorman/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">labs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"very slow"</span>, <span class="st">"slow"</span>, <span class="st">"average"</span>, <span class="st">"fast"</span>, <span class="st">"very fast"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">d</span><span class="op">$</span><span class="va">grp</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rev.html" class="external-link">rev</a></span><span class="op">(</span><span class="va">labs</span><span class="op">)</span></span>
<span></span>
<span><span class="va">d</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu">datawizard</span><span class="fu">::</span><span class="fu"><a href="https://easystats.github.io/datawizard/reference/demean.html" class="external-link">demean</a></span><span class="op">(</span><span class="va">d</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, by <span class="op">=</span> <span class="st">"grp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Between-subject effect of typing speed</span></span>
<span><span class="va">m1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_between</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">m1</span><span class="op">)</span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(103) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       38.32 | 1.33 | [35.69, 40.95] |  28.87 | &lt; .001</span></span>
<span><span class="co">#&gt; x between   |       -2.81 | 0.16 | [-3.13, -2.49] | -17.47 | &lt; .001</span></span>
<span></span>
<span><span class="co"># Between-subject effect of typing speed, accounting for group structure</span></span>
<span><span class="va">m2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lmer</a></span><span class="op">(</span><span class="va">y</span> <span class="op">~</span> <span class="va">x_between</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">grp</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">d</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/model_parameters.html">model_parameters</a></span><span class="op">(</span><span class="va">m2</span><span class="op">)</span></span>
<span><span class="co">#&gt; # Fixed Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter   | Coefficient |   SE |         95% CI | t(101) |      p</span></span>
<span><span class="co">#&gt; -------------------------------------------------------------------</span></span>
<span><span class="co">#&gt; (Intercept) |       37.02 | 2.73 | [31.59, 42.44] |  13.54 | &lt; .001</span></span>
<span><span class="co">#&gt; x between   |       -2.71 | 0.35 | [-3.40, -2.02] |  -7.81 | &lt; .001</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; # Random Effects</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter           | Coefficient |   SE |       95% CI</span></span>
<span><span class="co">#&gt; -------------------------------------------------------</span></span>
<span><span class="co">#&gt; SD (Intercept: grp) |        1.54 | 0.77 | [0.58, 4.09]</span></span>
<span><span class="co">#&gt; SD (Residual)       |        2.98 | 0.21 | [2.60, 3.42]</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="a-final-note---latent-mean-centering">A final note - latent mean centering<a class="anchor" aria-label="anchor" href="#a-final-note---latent-mean-centering"></a>
</h2>
<p>It can be even more complicated. The person-mean is only observed,
but the true value is not known. Thus, in certain situations, the
coefficients after de-meaning still might be (more or less) biased,
because it doesn’t appropriately account for the uncertainty in the
person-means. In this case, <em>latent mean centering</em> is
recommended, however, there are only few options to do this. One way is
using the great <strong>brms</strong> package, and this approach <a href="https://vuorre.netlify.app/posts/latent-mean-centering/" class="external-link">is
described here</a>.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-bafumi_fitting_2006" class="csl-entry">
Bafumi, Joseph, and Andrew Gelman. 2006. <span>“Fitting Multilevel
Models When Predictors and Group Effects Correlate.”</span> In.
Philadelphia, PA.
</div>
<div id="ref-bell_fixed_2019" class="csl-entry">
Bell, Andrew, Malcolm Fairbrother, and Kelvyn Jones. 2019. <span>“Fixed
and Random Effects Models: Making an Informed Choice.”</span>
<em>Quality &amp; Quantity</em> 53: 1051–74. <a href="https://doi.org/10.1007/s11135-018-0802-x" class="external-link">https://doi.org/10.1007/s11135-018-0802-x</a>.
</div>
<div id="ref-bell_explaining_2015" class="csl-entry">
Bell, Andrew, and Kelvyn Jones. 2015. <span>“Explaining Fixed Effects:
Random Effects Modeling of Time-Series Cross-Sectional and Panel
Data.”</span> <em>Political Science Research and Methods</em> 3 (1):
133–53. <a href="https://doi.org/10.1017/psrm.2014.7" class="external-link">https://doi.org/10.1017/psrm.2014.7</a>.
</div>
<div id="ref-gelman_data_2007" class="csl-entry">
Gelman, Andrew, and Jennifer Hill. 2007. <em>Data Analysis Using
Regression and Multilevel/Hierarchical Models</em>. Analytical Methods
for Social Research. Cambridge; New York: Cambridge University Press.
</div>
<div id="ref-heisig_costs_2017" class="csl-entry">
Heisig, Jan Paul, Merlin Schaeffer, and Johannes Giesecke. 2017.
<span>“The Costs of Simplicity: Why Multilevel Models May Benefit from
Accounting for Cross-Cluster Differences in the Effects of
Controls.”</span> <em>American Sociological Review</em> 82 (4): 796–827.
<a href="https://doi.org/10.1177/0003122417717901" class="external-link">https://doi.org/10.1177/0003122417717901</a>.
</div>
<div id="ref-mundlak_pooling_1978" class="csl-entry">
Mundlak, Yair. 1978. <span>“On the Pooling of Time Series and Cross
Section Data.”</span> <em>Econometrica</em> 46 (1): 69.
</div>
<div id="ref-shor_bayesian_2007" class="csl-entry">
Shor, Boris, Joseph Bafumi, Luke Keele, and David Park. 2007. <span>“A
Bayesian Multilevel Modeling Approach to Time-Series Cross-Sectional
Data.”</span> <em>Political Analysis</em> 15 (2): 165–81. <a href="https://doi.org/10.1093/pan/mpm006" class="external-link">https://doi.org/10.1093/pan/mpm006</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/strengejacke" class="external-link">Daniel Lüdecke</a>, <a href="https://dominiquemakowski.github.io/" class="external-link">Dominique Makowski</a>, <a href="https://home.msbstats.info/" class="external-link">Mattan S. Ben-Shachar</a>, <a href="https://sites.google.com/site/indrajeetspatilmorality/" class="external-link">Indrajeet Patil</a>, Søren Højsgaard, <a href="https://wiernik.org/" class="external-link">Brenton M. Wiernik</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.9000.</p>
</div>

    </footer>
</div>





  </body>
</html>
